<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="579px" preserveAspectRatio="none" style="width:971px;height:579px;" version="1.1" viewBox="0 0 971 579" width="971px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cnt0udd2aaik" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[9892c6f77c442752088fcf6c309c0000]
cluster sub--><polygon fill="#FFFFFF" filter="url(#f1cnt0udd2aaik)" points="16,255.5,26,245.5,954,245.5,954,562.5,944,572.5,16,572.5,16,255.5" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="944" x2="954" y1="255.5" y2="245.5"/><line style="stroke:#000000;stroke-width:1.5;" x1="16" x2="944" y1="255.5" y2="255.5"/><line style="stroke:#000000;stroke-width:1.5;" x1="944" x2="944" y1="255.5" y2="572.5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="264" x="349" y="271.4951">Subscription: (eg "Test Environment")</text><!--MD5=[9d1bc840e8c08a47989ba18e3476bb03]
cluster rgterra--><polygon fill="#FFFFFF" filter="url(#f1cnt0udd2aaik)" points="40,293.5,234,293.5,241,315.7969,444,315.7969,444,447.5,40,447.5,40,293.5" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="40" x2="241" y1="315.7969" y2="315.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="188" x="44" y="308.4951">Resource Group: Terraform</text><!--MD5=[55966dd18d1cda8b63162171a8d043e2]
cluster Storage account--><polygon fill="#FFFFFF" filter="url(#f1cnt0udd2aaik)" points="64,336.5,183,336.5,190,358.7969,214,358.7969,214,423.5,64,423.5,64,336.5" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="64" x2="190" y1="358.7969" y2="358.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="113" x="68" y="351.4951">Storage account</text><!--MD5=[d51ed98cc5c14ac4d5a04de60f3d663e]
cluster Key Vault--><polygon fill="#FFFFFF" filter="url(#f1cnt0udd2aaik)" points="238,336.5,310,336.5,317,358.7969,420,358.7969,420,423.5,238,423.5,238,336.5" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="238" x2="317" y1="358.7969" y2="358.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="66" x="242" y="351.4951">Key Vault</text><!--MD5=[3fbca4dee9755ebb21727493d8d02eef]
cluster rgmain--><polygon fill="#FFFFFF" filter="url(#f1cnt0udd2aaik)" points="476,323.5,634,323.5,641,345.7969,922,345.7969,922,540.5,476,540.5,476,323.5" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="476" x2="641" y1="345.7969" y2="345.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="152" x="480" y="338.4951">Resource Group: Main</text><!--MD5=[80ed8d81e4a492e35ffd11898e1ee476]
entity tfstate--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="36.2969" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="118" x="80" y="371.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="90" y="394.4951">Terraform state</text><!--MD5=[453192295ea561804c15db7bbafa0c9c]
entity storagekey--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="36.2969" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="150" x="254" y="371.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="264" y="394.4951">Storage Account Key</text><!--MD5=[ec0afc72f36e9f2cdb2b0546dec523bf]
entity Kubernetes Service--><polygon fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" points="519.5,376.5,529.5,366.5,682.5,366.5,682.5,402.7969,672.5,412.7969,519.5,412.7969,519.5,376.5" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="672.5" x2="682.5" y1="376.5" y2="366.5"/><line style="stroke:#000000;stroke-width:1.5;" x1="519.5" x2="672.5" y1="376.5" y2="376.5"/><line style="stroke:#000000;stroke-width:1.5;" x1="672.5" x2="672.5" y1="376.5" y2="412.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="534.5" y="399.4951">Kubernetes Service</text><!--MD5=[cf25d34b6f9695ab689953484c0b6ae1]
entity Storage--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="36.2969" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="67" x="717.5" y="371.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="727.5" y="394.4951">Storage</text><!--MD5=[fa1e3283224feb76407c84b7e90ed808]
entity Database--><path d="M819.5,377 C819.5,367 859,367 859,367 C859,367 898.5,367 898.5,377 L898.5,402.2969 C898.5,412.2969 859,412.2969 859,412.2969 C859,412.2969 819.5,412.2969 819.5,402.2969 L819.5,377 " fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" style="stroke:#000000;stroke-width:1.5;"/><path d="M819.5,377 C819.5,387 859,387 859,387 C859,387 898.5,387 898.5,377 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="829.5" y="403.9951">Database</text><!--MD5=[4b44f068ac4bd956a5a15bd1e389be63]
entity Resource 1--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="22.2969" style="stroke:#000000;stroke-width:1.5;" width="91" x="554.5" y="494.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="564.5" y="510.4951">Resource 1</text><!--MD5=[a1fdbf92e9e55a7918c190c8bd2ed26f]
entity Resource 2--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="22.2969" style="stroke:#000000;stroke-width:1.5;" width="91" x="680.5" y="494.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="690.5" y="510.4951">Resource 2</text><!--MD5=[3c48e7d95bb9107c5e5c0cc66ed0d318]
entity Resource n--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="22.2969" style="stroke:#000000;stroke-width:1.5;" width="91" x="806.5" y="494.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="816.5" y="510.4951">Resource n</text><!--MD5=[25f719494bd62b57f2de0576f80f7d6b]
entity ci--><ellipse cx="209" cy="14" fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" rx="8" ry="8" style="stroke:#A80036;stroke-width:1.5;"/><path d="M209,22 L209,49 M196,30 L222,30 M209,49 L196,64 M209,49 L222,64 " fill="none" filter="url(#f1cnt0udd2aaik)" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="136" y="82.4951">Continuous Integration</text><!--MD5=[5a9f12e3433feb7a47fb7cbcc8ee5d5d]
entity ops--><ellipse cx="346" cy="14" fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" rx="8" ry="8" style="stroke:#A80036;stroke-width:1.5;"/><path d="M346,22 L346,49 M333,30 L359,30 M346,49 L333,64 M346,49 L359,64 " fill="none" filter="url(#f1cnt0udd2aaik)" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="317.5" y="82.4951">Operator</text><!--MD5=[00f9e30d6ead67871b5f4dcdb52564e0]
entity tf--><rect fill="#FEFECE" filter="url(#f1cnt0udd2aaik)" height="36.2969" style="stroke:#A80036;stroke-width:1.5;" width="82" x="236" y="146.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="246" y="169.4951">Terraform</text><!--MD5=[3bbb443542bc08089f78df0512fd6139]
link tf to storagekey--><path d="M273.64,187.82 C272.36,200.18 271.69,215.77 274,229.5 C282.55,280.36 305.47,336.69 318.87,366.76 " fill="none" id="tf-storagekey" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="320.93,371.35,320.8985,361.5012,318.8847,366.7875,313.5985,364.7736,320.93,371.35" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="274.22,182.73,269.2157,191.2127,273.6474,187.6971,277.163,192.1289,274.22,182.73" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="275" y="225.5669">Unlocks storage account key</text><!--MD5=[04e7a4956a3138196fdbe6fd7e2bbb4e]
link tf to tfstate--><path d="M231.45,183.86 C218.16,191.09 204.63,200.57 195,212.5 C157.66,258.75 145.03,330.31 140.91,366.27 " fill="none" id="tf-tfstate" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="140.36,371.31,145.3133,362.7974,140.9028,366.3395,137.3606,361.929,140.36,371.31" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="235.94,181.49,226.1125,182.1381,231.5145,183.817,229.8356,189.219,235.94,181.49" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="196" y="225.5669">Reads state</text><!--MD5=[8d81fa061af599664bd901fd42925045]
link tf to rgmain--><path d="M318.27,165.66 C356.53,168.12 412.31,177.97 445,212.5 C472.11,241.135 481.9825,284.2175 485.0175,320.5888 C485.0649,321.1571 485.1107,321.7237 485.1548,322.2887 C485.1769,322.5711 485.1985,322.8532 485.2198,323.1348 " fill="none" id="tf-to-rgmain" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="485.2198,323.1348,488.5311,313.8593,484.8435,318.1489,480.5538,314.4613,485.2198,323.1348" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="457" y="225.5669">Provisions resources and reconciles state</text><!--MD5=[8c4aeaad0079c193737629f0bb6189e3]
link ops to tf--><path d="M322.64,85.78 C311.66,104.48 298.98,126.06 289.79,141.73 " fill="none" id="ops-to-tf" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="287.05,146.39,295.0659,140.6676,289.5888,142.0825,288.1739,136.6055,287.05,146.39" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[af0046e4acb19c97d0ca8c7c842454f0]
link ci to tf--><path d="M232.02,85.78 C242.85,104.48 255.33,126.06 264.4,141.73 " fill="none" id="ci-to-tf" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="267.1,146.39,266.0626,136.5959,264.5993,142.0603,259.135,140.597,267.1,146.39" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[14a5553292a79f5d6fb8388e452c7daf]
link Kubernetes Service to Storage--><!--MD5=[d854a292ca0e9a92e472ebd5858ed91c]
link Storage to Database--><!--MD5=[2bb4271ebc372dff5a714a07d6c91096]
link Kubernetes Service to Resource 1--><!--MD5=[4037d5280d93ecc9db2c77fba97d4f24]
link Resource 1 to Resource 2--><!--MD5=[cff112d53abf31b69245b99dc6655e65]
link Resource 2 to Resource n--><!--MD5=[0bed4eae08c480f14ba2bc146aaa53b7]
@startuml
actor "Continuous Integration" as ci
actor "Operator" as ops
agent "Terraform" as tf

node "Subscription: (eg "Test Environment")" as sub {
  package "Resource Group: Terraform" as rgterra {
    package "Storage account" {
      storage "Terraform state" as tfstate
    }

    package "Key Vault" {
      storage "Storage Account Key" as storagekey
    }

  }
  package "Resource Group: Main" as rgmain {
    node "Kubernetes Service"
    storage "Storage"
    database "Database"
    card "Resource 1"
    card "Resource 2"
    card "Resource n"
  }
}

tf <- -> storagekey: Unlocks storage account key
tf <- -> tfstate: Reads state
tf - -> rgmain: Provisions resources and reconciles state

ops - -> tf
ci - -> tf

@enduml

PlantUML version 1.2021.5(Sun Apr 25 11:20:28 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>